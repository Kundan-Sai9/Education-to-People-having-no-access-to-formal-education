{% extends 'base.html' %}

{% block title %}Available Courses{% endblock %}

{% block content %}
<h2 class="text-2xl font-bold mb-4">Available Courses</h2>

<!-- Search Form -->
<form method="get" class="mb-4 flex flex-col sm:flex-row sm:items-center gap-2">
  <input
    type="text"
    name="q"
    placeholder="Search courses..."
    value="{{ request.args.get('q', '') }}"
    class="border border-gray-300 rounded px-3 py-2 w-full sm:w-1/3"
  >

  <div>
    <label for="class_level" class="mr-2 font-medium">Select Class:</label>
    <select
      name="class_level"
      id="class_level"
      onchange="this.form.submit()"
      class="border border-gray-300 rounded px-2 py-1"
    >
      <option value="">-- All Classes --</option>
      {% for n in range(1,13) %}
        <option
          value="{{ n }}"
          {% if request.args.get('class_level')|int == n %}
            selected
          {% endif %}
        >
          Class {{ n }}
        </option>
      {% endfor %}
    </select>
  </div>
</form>

<!-- Error message if any -->
{% if error %}
  <div class="bg-red-100 text-red-700 p-3 rounded mb-4">
    {{ error }}
  </div>
{% endif %}

<!-- Courses list -->
{% if courses %}
<ul>
  {% for course in courses %}
  <li class="bg-white p-4 mb-2 rounded shadow">
    <h3 class="text-xl font-semibold">{{ course.title }}</h3>
    <p class="text-gray-700">{{ course.description }}</p>
    <p class="text-sm text-gray-500">Class: {{ course.class_level }}</p>
    {% if session.get('role') == 'student' %}
      <form action="{{ url_for('student.enroll', course_id=course.id) }}" method="post" class="mt-2">
        <button type="submit" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
          Enroll
        </button>
      </form>
    {% else %}
      <a href="{{ url_for('auth.login') }}" class="inline-block mt-2 bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
        Login to Enroll
      </a>
    {% endif %}
  </li>
  {% endfor %}
</ul>
{% else %}
<p class="text-gray-600">No courses found. Try adjusting your filters or search keywords.</p>
{% endif %}
{% endblock %}
